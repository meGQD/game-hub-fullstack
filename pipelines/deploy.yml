.deploy_rules:
  stage: deploy
  environment: 
    name: prod 
  tags:
    - prod

deploy prod:
  extends: .deploy_rules
  when: manual
  script:
    - helm upgrade --install backend ./kubernetes/charts/backend
    - helm upgrade --install frontend ./kubernetes/charts/frontend
    - helm upgrade --install redis-bitnami oci://registry-1.docker.io/bitnamicharts/redis --version 24.1.0 -f ./kubernetes/charts/redis/values.yaml
    - helm upgrade --install postgres-cloudpirates oci://registry-1.docker.io/cloudpirates/postgres --version 0.5.5 -f ./kubernetes/charts/postgres/values.yaml



# deploy beta:
#   stage: deploy
#   environment: 
#     name: beta
#   tags:
#     - beta
#   when: always
#   script:
#     - docker compose down || docker compose -f docker-compose.cicd.yml down
#     - docker compose up --build -d
